<!doctype html>
<html lang="si">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Get Pair Code</title>
  <style>
    :root { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial; }
    body { margin: 0; padding: 24px; background: #0f172a; color: #e2e8f0; }
    .wrap { max-width: 520px; margin: 0 auto; }
    .card {
      background: #111827; padding: 20px; border-radius: 16px;
      box-shadow: 0 10px 30px rgba(0,0,0,.35);
      border: 1px solid rgba(255,255,255,.06);
    }
    h1{margin:0 0 12px;font-size:24px}
    p{margin:0 0 16px;opacity:.85}
    label{display:block;font-size:14px;margin-bottom:8px;opacity:.9}
    input[type="tel"]{
      width:100%;padding:12px 14px;border-radius:12px;border:1px solid #374151;
      background:#0b1220;color:#e5e7eb;outline:none
    }
    .row{display:flex;gap:10px;margin-top:14px}
    button{
      padding:12px 16px;border:none;border-radius:12px;cursor:pointer;
      background:#2563eb;color:white;font-weight:600;flex:0 0 auto
    }
    button[disabled]{opacity:.5;cursor:not-allowed}
    .muted{font-size:12px;opacity:.8;margin-top:6px}
    .code{
      margin-top:16px;padding:14px;border-radius:12px;background:#0b1220;
      border:1px dashed #374151; font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;
      text-align:center; user-select: all; cursor: pointer;
    }
    .hidden{display:none}
    .toast{
      position:fixed;left:50%;transform:translateX(-50%);
      bottom:18px;background:#111827;border:1px solid #374151;color:#e5e7eb;
      padding:10px 14px;border-radius:999px;font-size:14px;opacity:0;transition:.25s all;
    }
    .toast.show{opacity:1;bottom:26px}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <h1>WhatsApp Pair Code</h1>
      <p>‡∂î‡∂∂‡∑ö WhatsApp ‡∂Ö‡∂Ç‡∂ö‡∂∫ (Country code ‡∑É‡∂∏‡∂ú, <b>+</b> ‡∂±‡∑ê‡∂≠‡∑í‡∑Ä) ‡∂∫‡∑ú‡∂Ø‡∂Ω‡∑è <b>Get Code</b> ‡∂ö‡∑ä‡∂Ω‡∑í‡∂ö‡∑ä ‡∂ö‡∂ª‡∂±‡∑ä‡∂±.</p>

      <label for="number">Phone number (e.g. 9471XXXXXXX)</label>
      <input id="number" type="tel" placeholder="9471XXXXXXX" inputmode="numeric" autocomplete="tel" />

      <div class="row">
        <button id="getBtn">Get Code</button>
        <button id="clearBtn" type="button">Clear</button>
      </div>
      <div class="muted">‡∑É‡∂ß‡∑Ñ‡∂±: ‡∂î‡∂∂‡∑ö server ‡∂ë‡∂ö‡∑ö <code>/pair?number=</code> endpoint ‡∂ë‡∂ö ‡∂∑‡∑è‡∑Ä‡∑í‡∂≠‡∑è ‡∂ö‡∂ª‡∂∫‡∑í.</div>

      <div id="codeBox" class="code hidden" title="Click to copy"></div>
      <div id="hint" class="muted hidden">üëâ Pair code ‡∂ß‡∂†‡∑ä/‡∂ö‡∑ä‡∂Ω‡∑í‡∂ö‡∑ä ‡∂ö‡∂Ω‡Æµ‡∂∏ clipboard ‡∂ë‡∂ö‡∂ß copy ‡∑Ä‡∑ö.</div>
    </div>
  </div>

  <div id="toast" class="toast">Copied!</div>

  <script>
    const el = {
      number: document.getElementById('number'),
      getBtn: document.getElementById('getBtn'),
      clearBtn: document.getElementById('clearBtn'),
      codeBox: document.getElementById('codeBox'),
      hint: document.getElementById('hint'),
      toast: document.getElementById('toast'),
    };

    function showToast(text){
      el.toast.textContent = text || 'Copied!';
      el.toast.classList.add('show');
      setTimeout(()=> el.toast.classList.remove('show'), 1400);
    }

    function onlyDigits(v){ return (v||'').replace(/\D/g,''); }

    async function getCode(){
      const raw = el.number.value.trim();
      const number = onlyDigits(raw);
      if(!number){
        showToast('‡∑É‡∂ª‡∑í‡∂∏‡∂≠‡∑ä ‡∂Ö‡∂Ç‡∂ö‡∂∫‡∂ö‡∑ä ‡¶¶‡¶ø‡¶®.');
        el.number.focus();
        return;
      }

      el.getBtn.disabled = true;
      el.getBtn.textContent = 'Working...';

      try {
        const res = await fetch(`/pair?number=${encodeURIComponent(number)}`);
        if(!res.ok){
          throw new Error('Request failed');
        }
        const data = await res.json();

        if(data && data.code){
          el.codeBox.textContent = data.code;
          el.codeBox.classList.remove('hidden');
          el.hint.classList.remove('hidden');
        }else{
          el.codeBox.textContent = 'Service Unavailable';
          el.codeBox.classList.remove('hidden');
        }
      } catch (err){
        el.codeBox.textContent = 'Error: ' + (err.message || err);
        el.codeBox.classList.remove('hidden');
      } finally {
        el.getBtn.disabled = false;
        el.getBtn.textContent = 'Get Code';
      }
    }

    async function copyCode(){
      const text = el.codeBox.textContent.trim();
      if(!text) return;
      try{
        await navigator.clipboard.writeText(text);
        showToast('Pair code copied!');
      }catch(_){
        // fallback
        const r = document.createRange();
        r.selectNode(el.codeBox);
        const sel = window.getSelection();
        sel.removeAllRanges(); sel.addRange(r);
        try{ document.execCommand('copy'); showToast('Pair code copied!'); }catch(_e){}
        sel.removeAllRanges();
      }
    }

    el.getBtn.addEventListener('click', getCode);
    el.clearBtn.addEventListener('click', ()=>{
      el.number.value = '';
      el.codeBox.textContent = '';
      el.codeBox.classList.add('hidden');
      el.hint.classList.add('hidden');
      el.number.focus();
    });
    el.codeBox.addEventListener('click', copyCode);
    el.codeBox.addEventListener('touchstart', (e)=>{ e.preventDefault(); copyCode(); }, {passive:false});
  </script>
</body>
</html>
